<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/Assets/Scripts/TitleController.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Assets/Scripts/TitleController.cs" />
              <option name="originalContent" value="using UnityEngine;&#10;using UnityEngine.UI;&#10;using TMPro;&#10;using Photon.Pun;&#10;using Photon.Realtime;&#10;&#10;/// &lt;summary&gt;&#10;/// タイトル画面の制御を行うクラス。&#10;/// Photonサーバーへの接続、部屋（ルーム）の作成、および既存の部屋への参加処理を担当する。&#10;/// アプリケーションのエントリーポイントとしての役割を持つ。&#10;/// &lt;/summary&gt;&#10;public class TitleController : MonoBehaviourPunCallbacks&#10;{&#10;    [Header(&quot;UI References&quot;)]&#10;    [SerializeField] private TMP_InputField roomIdInputField; // 部屋ID入力用&#10;    [SerializeField] private Button createRoomButton;&#10;    [SerializeField] private Button joinRoomButton;&#10;    [SerializeField] private Button settingsButton;&#10;    [SerializeField] private TextMeshProUGUI statusText;&#10;    [SerializeField] private GameObject connectingPanel;&#10;    [SerializeField] private SettingsController settingsController;&#10;&#10;    private void Start()&#10;    {&#10;        createRoomButton.onClick.AddListener(OnCreateRoomClicked);&#10;        joinRoomButton.onClick.AddListener(OnJoinRoomClicked);&#10;        &#10;        if (settingsButton != null &amp;&amp; settingsController != null)&#10;        {&#10;            settingsButton.onClick.AddListener(settingsController.OpenSettings);&#10;        }&#10;        &#10;        SetInteractable(false);&#10;        statusText.text = &quot;Photonに接続中...&quot;;&#10;        &#10;        // サーバーへの接続がまだ確立されていない場合のみ接続処理を行う&#10;        if (!PhotonNetwork.IsConnected)&#10;        {&#10;            PhotonNetwork.ConnectUsingSettings();&#10;        }&#10;        else&#10;        {&#10;            OnConnectedToMaster();&#10;        }&#10;    }&#10;&#10;    public override void OnConnectedToMaster()&#10;    {&#10;        Debug.Log(&quot;Photon Master Serverに接続しました&quot;);&#10;        statusText.text = &quot;部屋を作成するか、IDを入力して参加してください&quot;;&#10;        SetInteractable(true);&#10;        &#10;        if (connectingPanel != null)&#10;        {&#10;            connectingPanel.SetActive(false);&#10;        }&#10;    }&#10;&#10;    public override void OnDisconnected(DisconnectCause cause)&#10;    {&#10;        Debug.LogError($&quot;Photonから切断されました: {cause}&quot;);&#10;        statusText.text = $&quot;接続エラー: {cause}&quot;;&#10;        SetInteractable(false);&#10;    }&#10;&#10;    private void OnCreateRoomClicked()&#10;    {&#10;        // ユーザーが入力を省略できるよう、ランダムな6桁の数字を自動生成して部屋名とする&#10;        string roomName = Random.Range(100000, 999999).ToString();&#10;&#10;        statusText.text = $&quot;部屋「{roomName}」を作成中...&quot;;&#10;        SetInteractable(false);&#10;&#10;        // 特定の相手とだけ遊ぶ想定のため、ロビー一覧には表示せずID入力でのみ参加可能にする&#10;        RoomOptions roomOptions = new RoomOptions&#10;        {&#10;            MaxPlayers = 2,&#10;            IsVisible = false,&#10;            IsOpen = true&#10;        };&#10;&#10;        PhotonNetwork.CreateRoom(roomName, roomOptions, TypedLobby.Default);&#10;    }&#10;&#10;    private void OnJoinRoomClicked()&#10;    {&#10;        string roomName = roomIdInputField.text.Trim();&#10;        &#10;        if (string.IsNullOrEmpty(roomName))&#10;        {&#10;            statusText.text = &quot;部屋IDを入力してください&quot;;&#10;            return;&#10;        }&#10;&#10;        // IDは必ず6桁の数字であるため、事前チェックで無駄な通信を防ぐ&#10;        if (roomName.Length != 6)&#10;        {&#10;             statusText.text = &quot;部屋IDは6桁の数字です&quot;;&#10;             return;&#10;        }&#10;&#10;        statusText.text = $&quot;部屋「{roomName}」に参加中...&quot;;&#10;        SetInteractable(false);&#10;&#10;        PhotonNetwork.JoinRoom(roomName);&#10;    }&#10;&#10;    public override void OnJoinedRoom()&#10;    {&#10;        Debug.Log($&quot;部屋に参加しました: {PhotonNetwork.CurrentRoom.Name}&quot;);&#10;        statusText.text = &quot;部屋に参加しました！マッチングルームに移動中...&quot;;&#10;        &#10;        // 部屋に入れた時点でマッチング待機画面へ遷移する&#10;        PhotonNetwork.LoadLevel(&quot;MatchingRoom&quot;);&#10;    }&#10;&#10;    public override void OnCreateRoomFailed(short returnCode, string message)&#10;    {&#10;        Debug.LogError($&quot;部屋作成失敗: {message}&quot;);&#10;        // ランダム生成したIDが偶然重複した場合などが考えられる&#10;        statusText.text = &quot;部屋作成に失敗しました。もう一度お試しください。&quot;;&#10;        SetInteractable(true);&#10;    }&#10;&#10;    public override void OnJoinRoomFailed(short returnCode, string message)&#10;    {&#10;        Debug.LogError($&quot;部屋参加失敗: {message}&quot;);&#10;        statusText.text = $&quot;部屋参加失敗: {message}\n（IDが間違っているか、満員です）&quot;;&#10;        SetInteractable(true);&#10;    }&#10;&#10;    private void SetInteractable(bool interactable)&#10;    {&#10;        if (createRoomButton != null)&#10;            createRoomButton.interactable = interactable;&#10;        &#10;        if (joinRoomButton != null)&#10;            joinRoomButton.interactable = interactable;&#10;        &#10;        if (roomIdInputField != null)&#10;            roomIdInputField.interactable = interactable;&#10;            &#10;        if (settingsButton != null)&#10;            settingsButton.interactable = interactable;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="using UnityEngine;&#10;using UnityEngine.UI;&#10;using TMPro;&#10;using Photon.Pun;&#10;using Photon.Realtime;&#10;&#10;/// &lt;summary&gt;&#10;/// タイトル画面の制御を行うクラス。&#10;/// Photonサーバーへの接続、部屋（ルーム）の作成、および既存の部屋への参加処理を担当する。&#10;/// アプリケーションのエントリーポイントとしての役割を持つ。&#10;/// &lt;/summary&gt;&#10;public class TitleController : MonoBehaviourPunCallbacks&#10;{&#10;    [Header(&quot;UI References&quot;)]&#10;    [SerializeField] private TMP_InputField roomIdInputField; // 部屋ID入力用&#10;    [SerializeField] private Button createRoomButton;&#10;    [SerializeField] private Button joinRoomButton;&#10;    [SerializeField] private Button settingsButton;&#10;    [SerializeField] private TextMeshProUGUI statusText;&#10;    [SerializeField] private GameObject connectingPanel;&#10;    [SerializeField] private SettingsController settingsController;&#10;&#10;    private void Start()&#10;    {&#10;        createRoomButton.onClick.AddListener(OnCreateRoomClicked);&#10;        joinRoomButton.onClick.AddListener(OnJoinRoomClicked);&#10;        &#10;        if (settingsButton != null &amp;&amp; settingsController != null)&#10;        {&#10;            settingsButton.onClick.AddListener(settingsController.OpenSettings);&#10;        }&#10;        &#10;        SetInteractable(false);&#10;        statusText.text = &quot;Photonに接続中...&quot;;&#10;        &#10;        // サーバーへの接続がまだ確立されていない場合のみ接続処理を行う&#10;        if (!PhotonNetwork.IsConnected)&#10;        {&#10;            PhotonNetwork.ConnectUsingSettings();&#10;        }&#10;        else&#10;        {&#10;            OnConnectedToMaster();&#10;        }&#10;    }&#10;&#10;    public override void OnConnectedToMaster()&#10;    {&#10;        Debug.Log(&quot;Photon Master Serverに接続しました&quot;);&#10;        statusText.text = &quot;部屋を作成するか、IDを入力して参加してください&quot;;&#10;        SetInteractable(true);&#10;        &#10;        if (connectingPanel != null)&#10;        {&#10;            connectingPanel.SetActive(false);&#10;        }&#10;    }&#10;&#10;    public override void OnDisconnected(DisconnectCause cause)&#10;    {&#10;        Debug.LogError($&quot;Photonから切断されました: {cause}&quot;);&#10;        statusText.text = $&quot;接続エラー: {cause}&quot;;&#10;        SetInteractable(false);&#10;    }&#10;&#10;    private void OnCreateRoomClicked()&#10;    {&#10;        // ユーザーが入力を省略できるよう、ランダムな6桁の数字を自動生成して部屋名とする&#10;        string roomName = Random.Range(100000, 999999).ToString();&#10;&#10;        statusText.text = $&quot;部屋「{roomName}」を作成中...&quot;;&#10;        SetInteractable(false);&#10;&#10;        // 特定の相手とだけ遊ぶ想定のため、ロビー一覧には表示せずID入力でのみ参加可能にする&#10;        RoomOptions roomOptions = new RoomOptions&#10;        {&#10;            MaxPlayers = 2,&#10;            IsVisible = false,&#10;            IsOpen = true&#10;        };&#10;&#10;        PhotonNetwork.CreateRoom(roomName, roomOptions, TypedLobby.Default);&#10;    }&#10;&#10;    private void OnJoinRoomClicked()&#10;    {&#10;        string roomName = roomIdInputField.text.Trim();&#10;        &#10;        if (string.IsNullOrEmpty(roomName))&#10;        {&#10;            statusText.text = &quot;部屋IDを入力してください&quot;;&#10;            return;&#10;        }&#10;&#10;        // IDは必ず6桁の数字であるため、事前チェックで無駄な通信を防ぐ&#10;        if (roomName.Length != 6)&#10;        {&#10;             statusText.text = &quot;部屋IDは6桁の数字です&quot;;&#10;             return;&#10;        }&#10;&#10;        statusText.text = $&quot;部屋「{roomName}」に参加中...&quot;;&#10;        SetInteractable(false);&#10;&#10;        PhotonNetwork.JoinRoom(roomName);&#10;    }&#10;&#10;    public override void OnJoinedRoom()&#10;    {&#10;        Debug.Log($&quot;部屋に参加しました: {PhotonNetwork.CurrentRoom.Name}&quot;);&#10;        statusText.text = &quot;部屋に参加しました！マッチングルームに移動中...&quot;;&#10;        &#10;        // 部屋に入れた時点でマッチング待機画面へ遷移する&#10;        PhotonNetwork.LoadLevel(&quot;MatchingRoom&quot;);&#10;    }&#10;&#10;    public override void OnCreateRoomFailed(short returnCode, string message)&#10;    {&#10;        Debug.LogError($&quot;部屋作成失敗: {message}&quot;);&#10;        // ランダム生成したIDが偶然重複した場合などが考えられる&#10;        statusText.text = &quot;部屋作成に失敗しました。もう一度お試しください。&quot;;&#10;        SetInteractable(true);&#10;    }&#10;&#10;    public override void OnJoinRoomFailed(short returnCode, string message)&#10;    {&#10;        Debug.LogError($&quot;部屋参加失敗: {message}&quot;);&#10;        statusText.text = $&quot;部屋参加失敗: {message}\n（IDが間違っているか、満員です）&quot;;&#10;        SetInteractable(true);&#10;    }&#10;&#10;    private void SetInteractable(bool interactable)&#10;    {&#10;        if (createRoomButton != null)&#10;            createRoomButton.interactable = interactable;&#10;        &#10;        if (joinRoomButton != null)&#10;            joinRoomButton.interactable = interactable;&#10;        &#10;        if (roomIdInputField != null)&#10;            roomIdInputField.interactable = interactable;&#10;            &#10;        if (settingsButton != null)&#10;            settingsButton.interactable = interactable;&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>